# Look-Back and Look-Ahead Adaptive Model Predictive Control (LLA-MPC)

<div align="center">
<img src="results/LLA-MPC.jpg" width="600px"/>
</div>

This repository contains the code for the paper "LLA-MPC: Fast Adaptive Control for Autonomous Racing".

# Summary

## Video Presentation (Coming soon!)


## Numerical Simulations


<div align="center">
  <table>
    <tr>
      <!-- Image 1 -->
      <td>
        <img src="results/table1.png" width="400px"/> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          ETHZ Track
        </div>
      </td>
      <!-- Image 2 -->
      <td>
        <img src="results/table2.png" width="400px"/> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
         ETHZMobil Track
        </div>
      </td>
    </tr>
  </table>
</div>



### Experiment 1


#### ETHZ Track

<div align="center">
  <table>
    <tr>
      <!-- LLA-MPC -->
      <td>
        <img src="results/LLA/CASE 2 (GRAD AFTER)/lla1.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          LLA-MPC
        </div>
      </td>
      <!-- APACRace -->
      <td>
        <img src="results/APACRace/CASE 2 (GRAD AFTER)/apac1.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          APACRace
        </div>
      </td>
      <!-- Oracle -->
      <td>
        <img src="results/GT/CASE 2 (GRAD AFTER)/ora1.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          Oracle
        </div>
      </td>
    </tr>
  </table>
</div>



#### ETHZMobil Track

<div align="center">
  <table>
    <tr>
      <!-- LLA-MPC -->
      <td>
        <img src="results/LLA T2/CASE 2 (GRAD AFTER)/lla1_2.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          LLA-MPC
        </div>
      </td>
      <!-- APACRace -->
      <td>
        <img src="results/APACRace T2/CASE 2 (GRAD AFTER)/apac1_2.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          APACRace
        </div>
      </td>
      <!-- Oracle -->
      <td>
        <img src="results/GT T2/CASE 2 (GRAD AFTER)/ora1_2.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          Oracle
        </div>
      </td>
    </tr>
  </table>
</div>


### Experiment 2

#### ETHZ Track

<div align="center">
  <table>
    <tr>
      <!-- LLA-MPC -->
      <td>
        <img src="results/LLA/CASE 4 (SUDD AFTER) - 22/lla2.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          LLA-MPC
        </div>
      </td>
      <!-- APACRace -->
      <td>
        <img src="results/APACRace/CASE 4 (SUDD AFTER) - 22/apac2.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          APACRace
        </div>
      </td>
      <!-- Oracle -->
      <td>
        <img src="results/GT/CASE 4 (SUDD AFTER) - 22/ora2.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          Oracle
        </div>
      </td>
    </tr>
  </table>
</div>



#### ETHZMobil Track

<div align="center">
  <table>
    <tr>
      <!-- LLA-MPC -->
      <td>
        <img src="results/LLA T2/CASE 4 (SUDD AFTER) - 22/lla2_2.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          LLA-MPC
        </div>
      </td>
      <!-- APACRace -->
      <td>
        <img src="results/APACRace T2/CASE 4 (SUDD AFTER) - 22/apac2_2.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          APACRace
        </div>
      </td>
      <!-- Oracle -->
      <td>
        <img src="results/GT T2/CASE 4 (SUDD AFTER) - 22/ora2_2.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          Oracle
        </div>
      </td>
    </tr>
  </table>
</div>



### Experiment 3

#### ETHZ Track

<div align="center">
  <table>
    <tr>
      <!-- LLA-MPC -->
      <td>
        <img src="results/LLA/CASE 3 (SUDD BEG) - 22/lla3.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          LLA-MPC
        </div>
      </td>
      <!-- APACRace -->
      <td>
        <img src="results/APACRace/CASE 3 (SUDD BEG) - 22/apac3.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          APACRace
        </div>
      </td>
      <!-- Oracle -->
      <td>
        <img src="results/GT/CASE 3 (SUDD BEG) - 22/ora3.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          Oracle
        </div>
      </td>
    </tr>
  </table>
</div>



#### ETHZMobil Track

<div align="center">
  <table>
    <tr>
      <!-- LLA-MPC -->
      <td>
        <img src="results/LLA T2/CASE 3 (SUDD BEG) - 22/lla3_2.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          LLA-MPC
        </div>
      </td>
      <!-- APACRace -->
      <td>
        <img src="results/APACRace T2/CASE 3 (SUDD BEG) - 22/apac3_2.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          APACRace
        </div>
      </td>
      <!-- Oracle -->
      <td>
        <img src="results/GT T2/CASE 3 (SUDD BEG) - 22/ora3_2.gif" style="width: 400px;"> <!-- Adjust width as needed -->
        <div style="text-align: center; color: white; padding-top: 5px; background-color: rgba(0,0,0,0.7);">
          Oracle
        </div>
      </td>
    </tr>
  </table>
</div>



## CARLA Simulations

With LLA-MPC:
<div align="center">
<img src="results/CARLA%20W.gif" width="600px"/>
</div>

With nominal model only (no adaptation):
<div align="center">
<img src="results/CARLA%20WO.gif" width="600px"/>
</div>


# How to run the Code

## Installation
We recommend creating a new [conda](https://docs.conda.io/en/latest/) environment:

```
conda create --name llampc python=3.6
conda activate llampc
```
Then install LLA-MPC:

```
git clone https://github.com/DRIVE-LAB-CMU/LLA-MPC.git
cd LLA-MPC/
pip install -e .
```

## LLA-MPC

Run LLA-MPC  controller with the generated offline library of racelines as reference as follows:-
```
cd mpc
python run_nmpc_orca_llampc_rt.py
```

## APACRace
Run APACRace  controller with the generated offline library of racelines as reference as follows:-

```
cd mpc
python run_nmpc_orca_apacrace.py
```

## Oracle
Run the Oracle:-
```
cd mpc
python run_nmpc_oracle.py
```


